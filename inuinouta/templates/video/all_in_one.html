{% load static %}
<html>
  <head>
    <title>いぬいのうた | 戌亥とこ非公式ファンサイト</title>
    <meta name="description" content="いぬいのうたは、にじさんじ所属のバーチャルライバーである戌亥とこさんを応援するファンサイトです。戌亥とこさんが歌った楽曲を探しやすく、再生しやすいようにまとめています。">
    <meta name="keywords" content="戌亥とこ,ケルベロス,にじさんじ,歌,歌ってみた,バーチャルYouTuber,Vtuber,いぬいのうた,YouTube">
    <meta name="google-site-verification" content="ET167zHrokrdV7LkyXTpcLWAysh2k145WpWB4XkXRQc" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% static "images/favicon-32x32.png" %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static "images/favicon-16x16.png" %}">

<script src="https://kit.fontawesome.com/14c8f655ab.js" crossorigin="anonymous"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166010180-1"></script>
<script>

// ここで指定したidの動画がプレイヤーに初期ロードされる
var initialVideoId = "{{ initial_video.video_id }}";
var initialVideoStart  = {{ initial_song.start_at }};

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static "js/common.js" %}"></script>
<script src="{% static "js/site_pc.js" %}"></script>

<script>

/* 全ての曲と動画情報を書き出す */
var songList = new SongList();
var videoList = new VideoList();
var song_prev;
var video_prev;
{% for v in videos %}
video = new Video("{{ v.video_id }}", "{{ v.title }}");
if (video_prev) {
  video.prev = video_prev;
  video_prev.next = video;
}
{% for s in v.sorted_song_set %}
obj = new Song("{{ s.id }}", video, "{{ s.title }}", "{{ s.artist}}", {{ s.start_at }}, {{ s.end_at }} );
if (song_prev) {
  obj.prev = song_prev;
  song_prev.next = obj;
}
video.addSong(obj);
songList.addSong(obj);
song_prev = obj;

{% endfor %}
videoList.addVideo(video);
video_prev = video;
{% endfor %}
 
var songPlaying = songList.searchSong('{{initial_video.video_id}}', {{ initial_song.start_at }});

var enableAutoJump = true;
function switchAutoJump() {
  enableAutoJump = !enableAutoJump; 
}

function updateTweetData(song) {
  var intentUrl = "https://twitter.com/intent/tweet?";
  var text = "いぬいのうたで「" + song.title + "/" + song.artist + "」を再生中";
  var url = "https://inui-no-uta.herokuapp.com/?vid=" + song.video.id + "&sid=" + song.id;
  var hashtag = "いぬいのうた";

  var params = new URLSearchParams({
    "text": text,
    "url": url,
    "hashtags": hashtag
  });

  var obj = document.getElementById("twitter-share-link");
  obj.setAttribute("href", 
    intentUrl + params.toString()
  );
}

var firstPlay = false;
var checkPlayingSong = function() {
  if (!firstPlay) {
    return;
  }
  var video_id = player.getVideoData().video_id;
  var playing = songList.searchSong(video_id, player.getCurrentTime());
  songPlaying = playing;
  if (playing) {
    updateSongInfo(video_id, playing.title  + " / " + playing.artist, playing.video.title);
    updateTweetData(playing);
    updateSongRowStyle(playing);
  } else {
    updateSongInfo(video_id, "--- / ---", videoList.videos[video_id].title);
    updateSongRowStyle();
  }
}

var intervalProcess = function() {
  if (enableAutoJump) {
    controller.autoJump();
  }
  checkPlayingSong();
}

setInterval(intervalProcess, 1000);


</script>

<link href="{% static "css/pc.css" %}" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  </head>
  <body>
<div id="main">
  <div id="content">
    <div id="header">
      <h1>いぬいのうた</h1>
    </div>
    <div id="player-wrapper">
      <div id="youtube-player"><p onclick="loadPlayer()">クリックで再読み込み</p></div>
      <div class="player-message">
        <h2>使い方</h2>
        <p>
        曲名をクリックすると動画を読み込んで曲の頭出しをします。<br />
        <br />
        動画タイトルをクリックすると元動画に飛べます。また曲名リンクから新しいウィンドウを開いても元動画で頭出しができます。コメントを見たい場合などはそちらからどうぞ。
        </p>
      </div>
      <div class="player-message">
        <h2>このサイトについて</h2>
        <p>
        にじさんじ所属のバーチャルライバー、<strong><a href="https://www.youtube.com/channel/UCXRlIK3Cw_TJIQC5kSJJQMg?sub_confirmation=1">戌亥とこ</a></strong>さんの歌を視聴しやすいようにまとめた<u>非公式ファンサイト</u>です。
        戌亥とこさん及び"いちから株式会社"とは直接の関係はありません。
        </p>
        <p>
        ご意見、不具合報告等はツイッター(<a href="https://twitter.com/ino463">@ino463</a>)または<a href="https://marshmallow-qa.com/ino463">こちら</a>にでも。
        </p>
      </div>
    </div>
    <div id="video-wrapper">
    <table id='song-table'>
      <thead>
        <tr class="header-row">
          <th class="title">タイトル</th>
          <th class="artist">アーティスト</th>
          <th class="video-title">動画タイトル</th>
        </tr>
      </thead>
      <tbody>
      {% for v in videos %}
        {% for s in v.sorted_song_set %}
        <tr class="song-row" id="song-row-{{ s.id }}">
          <td class="title">
            <a href="{{v.url }}&t={{ s.start_at }}" title="{{ s.title }}" class="song-title" onclick="playSong(songList.songs[{{ s.id }}])"> <img src="http://img.youtube.com/vi/{{ v.video_id }}/mqdefault.jpg"></a>
            <a href="{{v.url }}&t={{ s.start_at }}" title="{{ s.title }}" class="song-title" onclick="playSong(songList.songs[{{ s.id }}])">{{ s.title }} </a>
          </td>
          <td class="artist">{{ s.artist }}</td>
          <td class="video-title"><a href="{{ v.url }}" title="{{ v.title }}">{{ v.title }}</a></td>
        </tr>
        {% endfor %}
      {% endfor %}
      </tbody>
    </table>
    </div>
  </div><!-- content end -->
  <div id="navigation-wrapper">
    <div id="navigation-left">
      <div id="navigation-thumb"><img src="http://img.youtube.com/vi/{{ initial_video.video_id }}/mqdefault.jpg" id="playing-thumb"></div>
      <div id="navigation-song-info">
        <div id="navigation-song-info-text">
          <div id="navigation-song-title">{{ initial_song.title}} / {{ initial_song.artist }}</div>
          <div id="navigation-video-title">{{ initial_video.title }}</div>
        </div>
      </div>
    </div>
    <div id="navigation-middle">
      <a href="#" title="前の曲へ" onclick="controller.playPrevSong()"><i class="fas fa-step-backward fa-2x fa-color-inui control-button" id="control-button-forward"></i>
      <a href="#" title="再生する" id="control-icon" onClick="changePlayingState()"><i class="far fa-play-circle fa-4x fa-color-inui"></i></a>
      <a href="#" title="次の曲へ" onclick="controller.playNextSong()"><i class="fas fa-step-forward fa-2x fa-color-inui control-button" id="control-button-forward"></i></a>
      <input type="checkbox" id="check-autojump" onchange="switchAutoJump(this)" checked><label for="check-autojump">自動で次の曲へ</label>
    </div>
    <div id="navigation-right">
      <div id="twitter-share">
        <a href="#" title="再生中の曲をシェアする" id="twitter-share-link" target="inui_no_uta">
          <i class="fab fa-twitter fa-2x fa-color-tweet"></i>
        </a>
      </div>
    </div>
  </div>
</div><!-- main end -->
<script>
updateTweetData(songPlaying);
</script>
</body>
</html>
